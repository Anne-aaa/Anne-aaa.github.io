<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Anne&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="👋 Hi, this is Anne, a software developer with expertise in [Kotlin&#x2F;Java &amp; Spring Boot]. My Github Page:https:&#x2F;&#x2F;github.com&#x2F;Anne-aaa">
<meta property="og:type" content="website">
<meta property="og:title" content="Anne&#39;s Blog">
<meta property="og:url" content="https://anne-aaa.github.io/index.html">
<meta property="og:site_name" content="Anne&#39;s Blog">
<meta property="og:description" content="👋 Hi, this is Anne, a software developer with expertise in [Kotlin&#x2F;Java &amp; Spring Boot]. My Github Page:https:&#x2F;&#x2F;github.com&#x2F;Anne-aaa">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Anne">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Anne's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anne&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://anne-aaa.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-backend/架构" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/24/backend/%E6%9E%B6%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2024-05-24T08:03:00.000Z" itemprop="datePublished">2024-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/05/24/backend/%E6%9E%B6%E6%9E%84/">架构</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="经典三层架构"><a href="#经典三层架构" class="headerlink" title="经典三层架构"></a>经典三层架构</h3><h3 id="DDD分层架构"><a href="#DDD分层架构" class="headerlink" title="DDD分层架构"></a>DDD分层架构</h3><p>其实之前项目上用的就是DDD，但是到今天我才从全貌去理解它，用一个订单系统举例子。 一个订单会包含多个订单项，订单的总金额需要是订单项金额的累计，因此 Order 与 OrderLine不应是两个单独的类，  用 <code>Aggregate</code> 这一概念来写Order， 外部通过Order来改OrderLine，避免错误。</p>
<p>也就是说，聚合根的存在是为了： 外部对象只能通过聚合根来访问和修改聚合内部的数据。现在再回到这个架构的名字：领域驱动开发</p>
<p><strong>包位置： domain</strong></p>
<p>包位置： domain&#x2F;models</p>
<p>Entity</p>
<ul>
<li>Order</li>
<li>OrderLine</li>
</ul>
<p>Value Object（属性描述）</p>
<ul>
<li>EffectivePeriod</li>
<li>Address</li>
</ul>
<p>Aggregate Root ： 它定义了一个聚合(Aggregate)的边界,并作为外部对象访问和修改聚合内部对象的唯一入口。</p>
<ul>
<li>InterestRateRequest 可以理解成OrderAggregate</li>
</ul>
<p>Domain Service (领域层服务专注于实现核心的业务逻辑)</p>
<p>包位置： domain&#x2F;service</p>
<ul>
<li>OrderService</li>
</ul>
<p>包位置： domain&#x2F;repository</p>
<ul>
<li>InterestRateRepository</li>
</ul>
<p>其实关于这一层，我忘记了当时项目上用的聚合根的场景了。还有关于领域服务，我们项目上似乎是没有领域服务的，业务逻辑都是写在应用层的。 只能说这里再之后多看看代码，具体场景具体分析了。这里我有的用了一些之前项目上的代码，已经经过脱敏处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OrderId id;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderLine&gt; orderLines;</span><br><span class="line">    <span class="keyword">private</span> Money totalAmount;</span><br><span class="line">    <span class="keyword">private</span> Address shippingAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrderLine</span><span class="params">(OrderLine orderLine)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加订单项</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">calculateTotalAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 计算订单总金额</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>聚合根：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">AggregateRoot</span>&lt;<span class="type">T : AggregateRoot&lt;T</span>&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">val</span> id: Id&lt;T&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">InterestRateRequest</span>(</span><br><span class="line">  <span class="keyword">val</span> effectivePeriod: String,</span><br><span class="line">  <span class="keyword">val</span> rate: BigDecimal,</span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">val</span> id: String</span><br><span class="line">) : AggregateRoot&lt;InterestRateRequest&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> log = LoggerFactory.getLogger(InterestRateRequest::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      rate: <span class="type">BigDecimal</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: InterestRateRequest &#123;</span><br><span class="line">      <span class="keyword">if</span> (...) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">        <span class="keyword">throw</span> BusinessException(</span><br><span class="line">          <span class="string">&quot;XXX&quot;</span>,</span><br><span class="line">          <span class="string">&quot;effective period is not match last one&quot;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (rate &gt; RATE_UPPER_LIMIT || rate &lt; RATE_LOWER_LIMIT) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">        <span class="keyword">throw</span> BusinessException(</span><br><span class="line">          <span class="string">&quot;AAA&quot;</span>,</span><br><span class="line">          <span class="string">&quot;interest rate not input more than 100% or less than 0%&quot;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">val</span> startOfTomorrow = LocalDate.now().atStartOfDay().plusDays(<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> (approvedOn.isBefore(startOfTomorrow)) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">        <span class="keyword">throw</span> BusinessException(</span><br><span class="line">          <span class="string">&quot;BBB&quot;</span>,</span><br><span class="line">          <span class="string">&quot;approved on must be after tomorrow and beyond&quot;</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> InterestRateRequest(</span><br><span class="line">        effectivePeriod = <span class="string">&quot;effectivePeriod&quot;</span>,</span><br><span class="line">        id = <span class="string">&quot;id&quot;</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下单和支付的核心业务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(OrderAggregate orderAggregate, PaymentDetails paymentDetails)</span> &#123;</span><br><span class="line">        <span class="comment">// 执行下单业务逻辑</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderAggregate.getOrder();</span><br><span class="line">        order.setStatus(OrderStatus.PLACED);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行支付逻辑</span></span><br><span class="line">        processPayment(order, paymentDetails);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其他下单相关的业务逻辑</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">(Order order, PaymentDetails paymentDetails)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用支付网关进行支付</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">paymentSuccessful</span> <span class="operator">=</span> callPaymentGateway(order, paymentDetails);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (paymentSuccessful) &#123;</span><br><span class="line">            order.setStatus(OrderStatus.PAID);</span><br><span class="line">            <span class="comment">// 执行其他支付成功后的逻辑</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            order.setStatus(OrderStatus.PAYMENT_FAILED);</span><br><span class="line">            <span class="comment">// 执行支付失败后的逻辑</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">FileRepository</span> &#123;</span><br><span class="line">  fun <span class="title function_">save</span><span class="params">(file: File)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>包位置：application</p>
<ul>
<li>PlaceOrderService   （之前在项目组用UseCase代替这里的Service）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlaceOrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderRepository orderRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PlaceOrderService</span><span class="params">(OrderService orderService, OrderRepository orderRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">        <span class="built_in">this</span>.orderRepository = orderRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(PlaceOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">OrderId</span> <span class="variable">orderId</span> <span class="operator">=</span> OrderId.next();</span><br><span class="line">        <span class="type">OrderAggregate</span> <span class="variable">orderAggregate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderAggregate</span>(orderId);</span><br><span class="line">        orderAggregate.setShippingAddress(request.getShippingAddress());</span><br><span class="line">        request.getOrderLines().forEach(ol -&gt; orderAggregate.addOrderLine(ol.getProduct(), ol.getQuantity()));</span><br><span class="line">        orderAggregate.submitOrder();</span><br><span class="line"></span><br><span class="line">        orderService.placeOrder(orderAggregate, request.getPaymentDetails());</span><br><span class="line"></span><br><span class="line">        orderRepository.save(orderAggregate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>包位置： infrastructure</p>
<p>包位置： infrastructure&#x2F;repository</p>
<ul>
<li>JooqInterestRateRequestRepository</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JooqInterestRateRequestRepository</span>(</span><br><span class="line">  <span class="keyword">private</span> val dslContext: DSLContext,</span><br><span class="line">) : InterestRateRequestRepository &#123;</span><br><span class="line">  <span class="type">val</span> <span class="variable">mapper</span> <span class="operator">=</span> MapperUtils.getMapper&lt;InterestRateRequestMapper&gt;()</span><br><span class="line"></span><br><span class="line">  override fun <span class="title function_">save</span><span class="params">(interestRateRequest: InterestRateRequest)</span> &#123;</span><br><span class="line">    mapper</span><br><span class="line">      .convertToRecord(interestRateRequest, dslContext.newRecord(PT_INTEREST_RATE_REQUEST))</span><br><span class="line">      .let &#123; dslContext.batchInsert(it).execute() &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>controller层都是一样的，我就省略不写了。我记得当时有一种情况，如果repository要对整个聚合根进行操作。 如果不是对整个聚合根操作，是放到另一个地方的。例子如下：    并不需要查出来整个聚合根</p>
<p>包位置: querymodel</p>
<p>包位置：querymodel&#x2F;repository</p>
<p>包位置：querymodel&#x2F;condition  所有可能的查询条件组合而成的数据模型</p>
<ul>
<li>CaseDocumentsCondition</li>
</ul>
<p>包位置：querymodel&#x2F;querymodel  想查出来的数据模型</p>
<ul>
<li>CaseDocumentQueryModel</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">CaseDocumentQueryModel</span>(</span><br><span class="line">  <span class="keyword">val</span> documentType: CaseDocumentType,</span><br><span class="line">  <span class="keyword">val</span> filename: String,</span><br><span class="line">  <span class="keyword">val</span> uploadedOn: LocalDateTime,</span><br><span class="line">  <span class="keyword">val</span> uploadedBy: UUID,</span><br><span class="line">  <span class="keyword">val</span> usedIn: CasePhase,</span><br><span class="line">  <span class="keyword">val</span> status: CaseDocumentStatus,</span><br><span class="line">  <span class="keyword">val</span> caseDocumentId: UUID</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">CaseDocumentsCondition</span>(</span><br><span class="line">  <span class="keyword">val</span> page: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> size: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> filenameSearchCondition: String? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> typeSearchCondition: String? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> startUploadedOnSearchCondition: LocalDate? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> uploadedBySearchCondition: String? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> statusSearchCondition: String? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> usedInSearchCondition: String? = <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">val</span> endUploadedOnSearchCondition: LocalDate? = <span class="literal">null</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">FileInfoQueryRepository</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">findDocumentBy</span><span class="params">(caseId: <span class="type">UUID</span>, condition: <span class="type">CaseDocumentsCondition</span>)</span></span>: CaseDocumentQueryModel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Anyway, 项目上的DDD架构看起来会稍微不一样一点。比如domain service没怎么用到，但是domain还会放repository的接口。  聚合根的使用也是如此，好多实体还有一个接口放在domain里面（不知道为啥)。 实体里面是有方法的（比如在request这个实体里，封装了判断rate是否正确，不正确报错，正确才返回真正的实体。  关于这一块，我记得也是有说法的。比如封装到实体里，那么从初始化开始，就不会生成不对的这个实体。 如果把这些判断封装到别的地方，会对逻辑有一些不同的影响）。</p>
<p>总结来说，DDD比起三层经典架构来说，多了一层domain，来放置抽象的infrastructure层的接口。 现在再看这张图，就觉得更理解一些了：</p>
<p><img src="/images/DDD1.png" alt="图片" title="Arch"><br>DDD中多的这个domain的包：</p>
<p>在DDD中,强调建立一种统一的领域语言。在这个例子中,开发团队和银行业务专家需要就”账户”、”存款”、”贷款”等概念达成共识,形成一套统一的术语和定义。例如,他们可能会约定:</p>
<ul>
<li>“账户”指的是客户在银行开立的账号,包括存款账户和贷款账户。</li>
<li>“存款”指的是客户存入银行的资金。</li>
<li>“贷款”指的是银行向客户发放的借款。</li>
</ul>
<p>通过建立这种统一的领域语言,开发人员和业务专家就能够在同一个语义基础上进行交流和讨论,减少理解上的偏差。当开发人员在编写代码时,他们可以直接使用这些约定好的术语,而不需要进行”翻译”。这样一来,代码就能够更好地反映业务领域的概念,从而确保系统符合真实的业务需求。</p>
<p>【未完待续..】</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://anne-aaa.github.io/2024/05/24/backend/%E6%9E%B6%E6%9E%84/" data-id="clwkeb9vq00095wpo9k7lh3zb" data-title="架构" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Hexo+ Github搭建一个个人博客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/21/Hexo+%20Github%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2024-05-21T07:18:47.000Z" itemprop="datePublished">2024-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/05/21/Hexo+%20Github%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">Hexo+ Github搭建一个个人博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一-搭建流程"><a href="#一-搭建流程" class="headerlink" title="一. 搭建流程"></a>一. 搭建流程</h3><p>详情见：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21193762">https://www.zhihu.com/question/21193762</a> 关于搭建的流程。再参考一些别的综合一下。</p>
<p>具体原理是，可以建立master和hexo两个分支，hexo分支用来存放hexo init出来的服务器，master是hexo的静态文件生成后部署到的分支。这样，即使换电脑，也可以继续把代码拉下来，继续用hexo写博客。</p>
<h3 id="二-过程中遇到的问题"><a href="#二-过程中遇到的问题" class="headerlink" title="二. 过程中遇到的问题"></a>二. 过程中遇到的问题</h3><p>电脑是mac 系统是zshrc，环境变量文件是.zshrc</p>
<p>环境变量最后一行写的是pnpm 所以我得用pnpm安装，才能识别到这个command</p>
<h3 id="三-日常改动："><a href="#三-日常改动：" class="headerlink" title="三. 日常改动："></a>三. 日常改动：</h3><ol>
<li>直接把.md文件复制到source&#x2F;_post文件夹中，复制完之后然后使用文本编辑器打开它，在第一行加上title。 也可以直接 hexo new 一篇博客。 图片放在source&#x2F;images文件夹中，md文档内，使用<img src="/%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80" alt="图片" title="图片title">的格式，圆括号内的链接地址写(&#x2F;images&#x2F;name.jpeg)。<br>这里的 &#x2F; 指的是根目录，对于hexo，资源文件的根目录就是source。</li>
<li>在.git目录下，依次执行git add .、git commit -m “…”、git push origin hexo指令将改动推送到GitHub（此时当前分支应为hexo</li>
<li>要进入hexo跟目录（和_config.yml同一目录下），删除旧的静态文件，即 public 文件<br>hexo clean。 然后才执行 hexo d -g 生成静态文件并部署到远程服务器,到master分支上。 需要等待一会才能见到。<br>hexo s可以先在本地预览。</li>
</ol>
<p>注意问题1.</p>
<p>如果你在运行<code>hexo</code>命令时出现了<code>Usage</code>提示而无法执行后面的子命令, 很可能是因为你当前所在的目录不是 Hexo 站点的根目录。Hexo 需要在站点根目录下才能正确执行命令。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://anne-aaa.github.io/2024/05/21/Hexo+%20Github%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" data-id="clwkeb9vi00005wpoejf12rif" data-title="Hexo+ Github搭建一个个人博客" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/" rel="tag">日常记录</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-第一次做前端中遇到的问题记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/21/%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%81%9A%E5%89%8D%E7%AB%AF%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2024-05-20T16:00:00.000Z" itemprop="datePublished">2024-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/05/21/%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%81%9A%E5%89%8D%E7%AB%AF%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">前端项目中遇到的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ol>
<li><p>Node.js：  Node.js则是一个独立的JavaScript运行环境,它可以让JavaScript代码运行在服务器端,而不仅限于浏览器,eg:</p>
 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">statusCode</span> = <span class="number">200</span>;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://localhost:3000/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于异步：</p>
</li>
</ol>
<p>Jest测试jsx， 其中findAllByText返回的是Promise对象，Promise对象是异步操作的成功或失败的结果。现在加关键字变成同步后，即等到findAllByText全部执行完才往下执行，就能得到list, 从而得到list的length.</p>
<p>这里的mock也值得注意。jest.fn()可以用jest判断调用次数，这里直接用findAllByText就可以不用jest.fn()。</p>
<p>由于我们不关心ProductCard的细节，所以mock这个组件时，可以给一个空的div</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;render, screen&#125; <span class="keyword">from</span> <span class="string">&#x27;@testing-library/react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ProductListPage</span> <span class="keyword">from</span> <span class="string">&#x27;../pages/ProductListPage/ProductListPage.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@testing-library/jest-dom&#x27;</span></span><br><span class="line"></span><br><span class="line">jest.<span class="title function_">mock</span>(<span class="string">&#x27;../components/ProductCard/ProductCard&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>mockModuleName<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;ProductListPage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;renders product list heading&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">ProductListPage</span> /&gt;</span></span>);</span><br><span class="line">        <span class="keyword">const</span> headingElement = screen.<span class="title function_">getByRole</span>(<span class="string">&#x27;heading&#x27;</span>, &#123; <span class="attr">level</span>: <span class="number">1</span> &#125;);</span><br><span class="line">        <span class="title function_">expect</span>(headingElement).<span class="title function_">toBeInTheDocument</span>();</span><br><span class="line">        <span class="title function_">expect</span>(headingElement).<span class="title function_">toHaveTextContent</span>(<span class="regexp">/Product List/i</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">test</span>(<span class="string">&#x27;renders at least 15 product cards&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">ProductListPage</span> /&gt;</span></span>);</span><br><span class="line">        <span class="keyword">const</span> productCards = <span class="keyword">await</span> screen.<span class="title function_">findAllByText</span>(<span class="string">&#x27;mockModuleName&#x27;</span>);</span><br><span class="line">        <span class="title function_">expect</span>(productCards.<span class="property">length</span>).<span class="title function_">toBeGreaterThanOrEqual</span>(<span class="number">15</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>搭建一个前端项目</li>
</ol>
<p>用Vite搭建，注意统一语言typescript&#x2F;javascript，以及包管理器可以用最新的pnpm。package.json看上去像后端的build.gradle。 测试配置的是Jest，安装后使用以下命令： 并且更新package.json即可， 无需再配置什么测试配置文件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@testing-library/jest-dom&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>语言共存</li>
</ol>
<p>我用vite搭建的是typescript, 入口文件也是typescript(我把main.tsx改成了index.tsx)。 但之后的page等我都用的jsx, 在入口文件引入时发现tsx引入不了jsx，可以采用以下操作，不必将tsx改成jsx，而是共存： <a target="_blank" rel="noopener" href="https://blog.csdn.net/yu359697395/article/details/78585267">https://blog.csdn.net/yu359697395/article/details/78585267</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">**&#123;</span><br><span class="line"><span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./built&quot;</span>,</span><br><span class="line"><span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span>,        <span class="comment">//</span></span><br><span class="line"><span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;include&quot;</span>: [</span><br><span class="line"><span class="string">&quot;./src/**/*&quot;</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>什么是组件 什么是props</li>
</ol>
<p>函数组件：函数组件是无状态的,没有生命周期方法,只负责接收数据(props)并渲染UI</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>箭头函数定义的组</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ProductListPage</span> = (<span class="params"></span>) =&gt; &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>在 React 中，我们不应该直接修改状态变量，而是使用 <strong><code>setState</code></strong> 或 <strong><code>useState</code></strong> 提供的更新函数来更新状态，而不是直接修改状态变量。这样可以确保状态的更新是可控的，并且 React 可以正确地处理重新渲染。</p>
<ol start="6">
<li>分页展示</li>
</ol>
<p>比如下面这段代码，当 currentPage 状态更新后，React 会重新渲染组件，使用新的 currentPage 值计算出新的 startIndex、endIndex 和 currentProducts。所以每页展示的内容不一样</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ProductListPage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//变量currentPage初始值为1  函数setCurrentPage用于更新currentPage</span></span><br><span class="line">    <span class="keyword">const</span> [currentPage, setCurrentPage] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//每页展示的产品数量</span></span><br><span class="line">    <span class="keyword">const</span> itemsPerPage = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">//向上取整 页数</span></span><br><span class="line">    <span class="keyword">const</span> totalPages = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(products.<span class="property">length</span> / itemsPerPage);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> startIndex = (currentPage - <span class="number">1</span>) * itemsPerPage;</span><br><span class="line">    <span class="keyword">const</span> endIndex = startIndex + itemsPerPage;</span><br><span class="line">    <span class="comment">//切片</span></span><br><span class="line">    <span class="keyword">const</span> currentProducts = products.<span class="title function_">slice</span>(startIndex, endIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handlePageChange</span> = (<span class="params">pageNumber</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 会更新currentPage,当 currentPage 状态更新后，React 会重新渲染组件，使用新的 currentPage 值计算出新的 startIndex、endIndex 和 currentProducts。</span></span><br><span class="line">        <span class="title function_">setCurrentPage</span>(pageNumber);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;product-list-page&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;product-list-heading&quot;</span>&gt;</span>Product List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;product-list-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;currentProducts.map((product) =&gt; (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ProductCard</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">key</span>=<span class="string">&#123;product.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">product</span>=<span class="string">&#123;product&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">data-testid</span>=<span class="string">&quot;product-card&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                ))&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/*分页按钮*/&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;Array.from(&#123; length: totalPages &#125;, (_, i) =&gt; (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">key</span>=<span class="string">&#123;i</span> + <span class="attr">1</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handlePageChange(i + 1)&#125;</span></span><br><span class="line"><span class="language-xml">                        className=&#123;currentPage === i + 1 ? &#x27;active&#x27; : &#x27;&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">                    &gt;</span></span><br><span class="line"><span class="language-xml">                        &#123;i + 1&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                ))&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>npm install会把所有import的东西都install吗？<br>如果你导入的模块没有在package.json中列出,那么npm install将不会安装它。你需要手动将该模块添加到dependencies或devDependencies中,然后再运行npm install。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://anne-aaa.github.io/2024/05/21/%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%81%9A%E5%89%8D%E7%AB%AF%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" data-id="clwkeb9vm00015wpo2ot47rn8" data-title="前端项目中遇到的问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-读书笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/21/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-05-20T16:00:00.000Z" itemprop="datePublished">2024-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/05/21/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">《Spring 4.x 企业应用开发实战》读书笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h1><p>源代码：<a target="_blank" rel="noopener" href="https://github.com/seriouszyx/LearnSpring/tree/master/source%20code">https://github.com/seriouszyx/LearnSpring/tree/master/source%20code</a><br><a target="_blank" rel="noopener" href="http://iteye.com/">http://iteye.com</a></p>
<h5 id="为什么云的兴起使得消除开发者和运营者的隔阂更重要？"><a href="#为什么云的兴起使得消除开发者和运营者的隔阂更重要？" class="headerlink" title="为什么云的兴起使得消除开发者和运营者的隔阂更重要？"></a>为什么云的兴起使得消除开发者和运营者的隔阂更重要？</h5><p>什么是运营者？</p>
<ul>
<li>传统上,开发者和运营者是分开的两个角色。开发者完成应用程序开发后,就把代码交给运营者。运营者需要将代码部署到服务器上,并负责后续的系统运维工作。</li>
</ul>
<ol>
<li><p>云环境下应用程序的复杂性增加。现代软件项目通常依赖数百个外部依赖项和多个关键服务,运行在云端。开发者需要熟悉和管理大量云服务、工具和平台,工作负担加重。这就需要开发者和运营者密切协作,共同分担责任。</p>
</li>
<li><p>DevOps文化的兴起。当今科技公司普遍采用”开发者全权负责”的DevOps文化,开发者不仅负责编码,还参与测试、部署、维护等环节。这种共同责任模式要求开发者和运营者的角色高度融合。</p>
</li>
</ol>
<h5 id="什么功能用传统的OOP不易实现，用AOP却可以轻松应对？"><a href="#什么功能用传统的OOP不易实现，用AOP却可以轻松应对？" class="headerlink" title="什么功能用传统的OOP不易实现，用AOP却可以轻松应对？"></a>什么功能用传统的OOP不易实现，用AOP却可以轻松应对？</h5><ul>
<li>面向对象编程(OOP)不太擅长处理的是一些与核心业务逻辑无关,但又需要在多个模块中重复出现的代码,我们称之为”横切关注点”。而面向切面编程(AOP)就是为了解决这个问题而诞生的。 AOP主要应用场景包括日志记录,性能统计,安全控制,事务处理,异常处理等等。”这些功能虽然不是核心业务逻辑,但又需要在许多模块中重复实现,使用传统OOP的做法就会导致代码的冗余和低内聚。</li>
</ul>
<p>IOC和AOP是Spring以来的根本</p>
<ul>
<li>传统编程用new来创建，现在交给Spring容器注入。</li>
<li>传统编程中,对象创建对象,并且负责对象的生命周期。而在IOC模式下,由容器控制对象的创建、初始化以及实例的生命周期。对象本身只需要提供标准的构造函数即可。<br>![[Pasted image 20240508151528.png]]</li>
</ul>
<h5 id="数据访问和集成："><a href="#数据访问和集成：" class="headerlink" title="数据访问和集成："></a>数据访问和集成：</h5><p>数据有多种表现形式，如数据表、XML、消息。每种数据形式拥有不同的数据访问技术（数据表的访问可以直接通过JDBC，JOOQ，也可以通过Hibernate或MyBatis）</p>
<ul>
<li>这些都是不同的实现技术，但是同样的解决问题。比如不同的测试框架</li>
<li>Spring建立起了和数据形式及访问技术无关的统一的DAO层<br>eg.   首先,定义一个技术无关的DAO接口:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123; List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>; User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>; <span class="comment">// ... &#125;</span></span><br></pre></td></tr></table></figure>
  然后,使用JOOQ实现这个DAO接口</li>
</ul>
<h2 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h2><p>基于Spring的Web应用</p>
<p>JSP是一种动态页面，是传统的MVC，要返回给浏览器的动态页面。<br>什么是Web容器？</p>
<ol>
<li>Web容器能够解析并执行动态资源(如JSP、Servlet),而不仅仅是返回静态HTML页面。</li>
<li>常见的Web容器有Tomcat、Jetty等,它们通常以嵌入式的方式运行在应用程序中。</li>
<li>在微服务架构中,轻量级的Web容器(如Tomcat)被广泛使用,因为它们占用较少资源,易于部署和集成。</li>
</ol>
<p>Jetty</p>
<ul>
<li>IDEA的免费社区版本本身不直接支持开发Web项目,需要额外配置Web服务器环境。而Jetty作为一个轻量级的嵌入式Web服务器,可以很方便地集成到IDEA中,为Web项目提供运行环境.</li>
<li>与传统的Web服务器(如Tomcat)相比,Jetty更加轻量级,占用系统资源更少,启动速度也更快。这使得在开发阶段使用Jetty更加高效</li>
</ul>
<p>Spring的声明式事务</p>
<ul>
<li>Spring的声明式事务管理就像是安排了一个”监工”在旁边监督,确保付款的每个步骤都正确执行。如果中间出现任何问题,这个”监工”会立即停止后续步骤,并让整个过程回到最初状态,避免数据不一致。使用Spring声明式事务,我们不需要手动编写监控和回滚事务的代码,只需在关键的业务方法上标注@Transactional注解,Spring就会自动为这些方法增加事务管理的能力,确保事务either全部成功或全部失败回滚,不会出现中间状态。</li>
</ul>
<h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><p>Spring Boot</p>
<ul>
<li>内嵌Tomcat和Jetty容器，不需要部署WAR 文件到Web容器就可独立运行 应用</li>
</ul>
<p>jar包和war包是什么，为什么要将程序打包成他们？</p>
<h5 id="运维功能"><a href="#运维功能" class="headerlink" title="运维功能"></a>运维功能</h5><ul>
<li>当应用部署到生产环境时，需要各种运维相关的功能 的支持，如监控应用的各种性能指标、运行信息和应用状态等。SpringBoot 对这些运维监控相关的类库 进 行 了整 合 ， 形 成 了一 个功 能 完 备 和 可 定 制 的 启 动 器 ， 称 为 A c t u a t o r 。<br>基于Spring Boot应用，添加监控功能非常简单，只需在应用的pom.xml 文件中添 加spring-boot-starter-actuator 依赖即可</li>
<li>Spring Boot 默认提供的健康检查关键服务。这些服务都可以在 application.properties 的management .health. *选项中进行配置</li>
</ul>
<p>pom.xml与application.properties</p>
<ul>
<li><ol>
<li>pom.xml文件: 相当于build.gradle<br>它是Maven项目的核心配置文件,用于定义项目的构建配置。<br> pom.xml文件中包含了项目的依赖库、插件、构建生命周期等信息。</li>
</ol>
</li>
<li><ol start="2">
<li><strong>application.properties文件</strong>:<br>它是Spring Boot等Java应用程序的配置文件,用于配置应用程序的运行时参数。<br>application.properties文件中包含了数据库连接信息、服务器端口、日志级别等配置项。</li>
</ol>
</li>
</ul>
<h2 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h2><p>IOC：</p>
<ul>
<li>IOC这个概念不够清晰，即某 一接又具体实现类的选择控制权从调用类中移除， 转交给第 三方决定，即由Spring容器借由Bean配置来进行控制。<br>DI：</li>
<li>因为IoC确实不够开门见山，因此业界曾进行了广泛的讨论，最终软件界的泰斗级 人物MartinFowler 提出了DI (DependencyInjection，依赖注入)的概念用来代替IoC， 即让调用类对某一接又实现类的依赖关系由第三方 (容器或协作类)注入，以移除调用 类 对 某 一接 又 实 现 类 的 依 赖 。 “ 依 赖 注 入 ” 这 个 名 词 显 然 比 “ 控 制 反 转 ” 直 接 明 了 、 易 于理解。</li>
</ul>
<p>构造注入 与 属性注入：</p>
<ul>
<li>并非每个场景都需要它的时候，与构造注入它就显得不太妥当，于是用属性注入。属性注入可以有选择地通过Setter 方法完成调用类所需依赖的注入，更加灵活方便。 也就是”按需注入”<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造注入革席的具体饰演者 </span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MoAttack</span> <span class="params">(GeLi geli)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.geli = geli;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//属性注入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGeli</span> <span class="params">(GeLi geli)</span> &#123;</span><br><span class="line">thisgeli = geli;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>JVM</p>
<ul>
<li>JVM将Java源代码编译成字节码,然后将字节码解释成机器码,以便在不同的平台上运行。这使得Java程序可以在不同的平台上运行,而不需要重新编译。</li>
<li>JVM装载类时使用 “全盘负责委托机制”，“ 全盘负责” 是指当一个ClassLoader 装 载 一 个 类 时 ， 除 非 显 式 地 使 用 另一 个 C l a s s L o a d e r ， 该 类 所 依 赖 及 引 用 的 类 也 由 这 个 ClassLoader 载</li>
</ul>
<p>Jar包</p>
<ul>
<li>jar包是由Java语言编写的程序,将其编译后的.class文件和其他必要资源文件打包成一个文件,以便于分发和部署。</li>
</ul>
<p>ClassLoader:</p>
<ul>
<li>类装载器 就是 寻找类的字节码文件并构造 出 类 在 J V M 内 部 表 示 对 象 的 组 件 。 在 J a v a 中，类装载器把一个类装入J M中。</li>
</ul>
<p>JDK：</p>
<ul>
<li>JDK(Java Development Kit)是Java语言的开发工具包,包含了Java编译器(将Java源代码编译成.class文件,然后执行这些.class文件。)、Java运行时环境(执行Java程序)和其他开发工具(如debugger、profiler)。</li>
</ul>
<p>BeanFactory 是Spring 框架的基础设 施，面向Spring 本身:ApplicationContext 面向使用Spring 框架的开发者，几乎所有的 应用场合都可以直接使用ApplicationContext 而非底层的BeanFactory</p>
<h2 id="第五章"><a href="#第五章" class="headerlink" title="第五章"></a>第五章</h2><h5 id="1-书中用到了1️⃣配置文件来写这个class是一个bean，但实际项目上并没有这样做，而是好像直接用2️⃣注解引入，这是什么意思？"><a href="#1-书中用到了1️⃣配置文件来写这个class是一个bean，但实际项目上并没有这样做，而是好像直接用2️⃣注解引入，这是什么意思？" class="headerlink" title="1. 书中用到了1️⃣配置文件来写这个class是一个bean，但实际项目上并没有这样做，而是好像直接用2️⃣注解引入，这是什么意思？"></a>1. 书中用到了1️⃣配置文件来写这个class是一个bean，但实际项目上并没有这样做，而是好像直接用2️⃣注解引入，这是什么意思？</h5><pre><code>- 从Spring 2.5开始,引入了基于注解(@Annotation)的配置方式。开发者可以直接在Bean类上使用@Component、@Service、@Repository、@Controller等注解将其声明为Bean,而不需要在XML中重复配置。这种方式更加简洁、高效,也是当前推荐的配置方式。
</code></pre>
<p>eg.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123; </span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">(<span class="type">int</span> userId)</span> &#123; <span class="comment">// 查询用户名的逻辑 return &quot;John Doe&quot;; &#125; </span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>@Service</code>注解,Spring就可以自动扫描到这个类,并将其注册为一个Bean,名称默认为”userService”(类名的第一个字母小写)。接下来,如果我们有另一个组件需要使用UserService,可以使用<code>@Autowired</code>注解自动注入:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired; <span class="keyword">import</span> org.springframework.stereotype.Component; </span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printUserName</span><span class="params">(<span class="type">int</span> userId)</span> &#123; </span><br><span class="line"> <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> userService.getUserName(userId); System.out.println(<span class="string">&quot;User name: &quot;</span> + userName); </span><br><span class="line"> &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>@Component</code>注解将<code>UserController</code>标记为一个Bean。</li>
<li><code>@Autowired</code>注解自动将<code>UserService</code>的Bean注入到<code>userService</code>字段中。</li>
</ol>
<p>通过这种方式,Spring可以自动扫描和注册所有标记了<code>@Component</code>、<code>@Service</code>等注解的类作为Bean,并自动注入它们之间的依赖关系。</p>
<p>如 果 容 器 中 有 一 个 以 上匹 配 的 B e a n 时 ， 则 可 以 通 过 @ Q u a l i f i e r 注 解 限 定 B e a n 的 名 称，<br>一般 情 况 下 ， 在 S p r i n g 容 器 中 大 部 分 B e a n 都 是 单 实 例 的 ， 所 以 一般 无 须 通 过@Repository、@Service 等注解的value 属性为Bean 指定名称，也无须使用@Qualifier 注解按名称进行注入。</p>
<p>还可以通过3️⃣@Configuration来为一个POJO 标注为配置类，里面就可以定义@Bean(比如Service Bean, Dao Bean)，以及Bean的实例化逻辑</p>
<h5 id="2-关于Bean的作用域："><a href="#2-关于Bean的作用域：" class="headerlink" title="2. 关于Bean的作用域："></a>2. 关于Bean的作用域：</h5><p>首先要理解”单例模式”，一个类只有一个实例，适合用来管理共享资源。s i n g l e t o n 的 B e a n 在 同 一S p r i n g I o C 容 器 中 只 有 一个 实例。<br>S p r i n g 的 A p p l i c a t i o n C o n t e x t 容 器 在 启 动 时 ，自 动 实 例 化 所 有 s i n g l e t o n 的Bean 并缓存于容器中。虽然启动时会花费一些时间，但它带来两个好处:首先，对 Bean提前进行实例化操作会及早发现一些潜在的配置问题</p>
<p>在 默 认 情 况 下， S p r i n g 容 器 在 启 动 时 不 实 例 化 p r o t o t y p e 的 B e a n<br>request作用域<br>顾 名 思 义 ， r e q u e s t 作 用 域 的 B e a n 对 应 一个 H T T P 请 求 和 生 命 周 期</p>
<p>什么场景下用单例Bean,什么场景下用prototype的bean？</p>
<ul>
<li>想象一下,我们有一个学校,学校里有很多老师和学生。每个老师都有一个自己的教室,里面有一个小黑板。如果我们使用单例bean来表示小黑板,那就意味着所有老师都共享同一个小黑板。这样的话,如果张老师在小黑板上写了”2+3&#x3D;5”,李老师过来上课时,小黑板上还是显示”2+3&#x3D;5”,这就会造成混乱。相反,如果我们使用session bean来表示小黑板,每个老师都会有自己专属的小黑板。这样,张老师在自己的小黑板上写”2+3&#x3D;5”,李老师在自己的小黑板上写”5+7&#x3D;12”,两个老师之间就不会互相影响了。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://anne-aaa.github.io/2024/05/21/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" data-id="clwkeb9vo00035wpo1inff55q" data-title="《Spring 4.x 企业应用开发实战》读书笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/" rel="tag">日常记录</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 20px;">后端</a> <a href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">日常记录</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/05/24/backend/%E6%9E%B6%E6%9E%84/">架构</a>
          </li>
        
          <li>
            <a href="/2024/05/21/Hexo+%20Github%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">Hexo+ Github搭建一个个人博客</a>
          </li>
        
          <li>
            <a href="/2024/05/21/%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%81%9A%E5%89%8D%E7%AB%AF%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">前端项目中遇到的问题</a>
          </li>
        
          <li>
            <a href="/2024/05/21/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">《Spring 4.x 企业应用开发实战》读书笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Anne<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>